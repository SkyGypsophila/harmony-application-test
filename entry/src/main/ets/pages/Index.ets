import { hilog } from '@kit.PerformanceAnalysisKit';
import { router } from '@kit.ArkUI';

const DOMAIN = 0x0000;

interface HistoricalEvent {
  year: number;
  title: string;
  description: string;
}

// æ•°æ®åº“ç±»
class HistoricalEventsData {
  private static events: Map<string, HistoricalEvent[]> = new Map<string, HistoricalEvent[]>([
    // 1æœˆ
    ['1-1', [
      { year: 2002, title: 'æ¬§å…ƒæµé€š', description: 'æ¬§å…ƒåœ¨12ä¸ªæ¬§æ´²å›½å®¶å¼€å§‹æµé€š'} as HistoricalEvent
    ]],
    ['1-15', [
      { year: 2001, title: 'ç»´åŸºç™¾ç§‘', description: 'ç»´åŸºç™¾ç§‘æ­£å¼ä¸Šçº¿'} as HistoricalEvent
    ]],
    ['1-27', [
      { year: 2010, title: 'iPadå‘å¸ƒ', description: 'è‹¹æœå…¬å¸å‘å¸ƒç¬¬ä¸€ä»£iPad'} as HistoricalEvent
    ]],

    // 2æœˆ
    ['2-14', [
      { year: 1876, title: 'ç”µè¯å‘æ˜', description: 'äºšå†å±±å¤§Â·è´å°”è·å¾—ç”µè¯ä¸“åˆ©'} as HistoricalEvent,
      { year: 1929, title: 'æƒ…äººèŠ‚å¤§å± æ€', description: 'èŠåŠ å“¥é»‘å¸®ç«æ‹¼äº‹ä»¶'} as HistoricalEvent
    ]],
    ['2-24', [
      { year: 1955, title: 'ä¹”å¸ƒæ–¯è¯ç”Ÿ', description: 'è‹¹æœå…¬å¸è”åˆåˆ›å§‹äººå²è’‚å¤«Â·ä¹”å¸ƒæ–¯å‡ºç”Ÿ'} as HistoricalEvent,
      { year: 2022, title: 'ä¿„ä¹Œæˆ˜äº‰', description: 'ä¿„ç½—æ–¯å¯¹ä¹Œå…‹å…°å‘åŠ¨å…¨é¢å…¥ä¾µ'} as HistoricalEvent
    ]],

    // 3æœˆ
    ['3-8', [
      { year: 1911, title: 'å›½é™…å¦‡å¥³èŠ‚', description: 'é¦–ä¸ªå›½é™…åŠ³åŠ¨å¦‡å¥³èŠ‚'} as HistoricalEvent
    ]],
    ['3-14', [
      { year: 1879, title: 'çˆ±å› æ–¯å¦è¯ç”Ÿ', description: 'ç‰©ç†å­¦å®¶é˜¿å°”ä¼¯ç‰¹Â·çˆ±å› æ–¯å¦å‡ºç”Ÿ'} as HistoricalEvent,
      { year: 1995, title: 'IEæµè§ˆå™¨', description: 'å¾®è½¯å‘å¸ƒInternet Explorer 1.0'} as HistoricalEvent
    ]],

    // 4æœˆ
    ['4-12', [
      { year: 1961, title: 'åŠ åŠ æ—å¤ªç©ºé£è¡Œ', description: 'å°¤é‡ŒÂ·åŠ åŠ æ—æˆä¸ºç¬¬ä¸€ä¸ªè¿›å…¥å¤ªç©ºçš„äººç±»'} as HistoricalEvent,
      { year: 1981, title: 'å“¥ä¼¦æ¯”äºšå·', description: 'å“¥ä¼¦æ¯”äºšå·èˆªå¤©é£æœºé¦–æ¬¡é£è¡Œ'} as HistoricalEvent
    ]],

    // 5æœˆ
    ['5-1', [
      { year: 1886, title: 'å›½é™…åŠ³åŠ¨èŠ‚', description: 'èŠåŠ å“¥å·¥äººç½¢å·¥ï¼Œåæˆä¸ºå›½é™…åŠ³åŠ¨èŠ‚èµ·æº'} as HistoricalEvent
    ]],
    ['5-8', [
      { year: 1945, title: 'æ¬§æ´²èƒœåˆ©æ—¥', description: 'äºŒæˆ˜æ¬§æ´²æˆ˜åœºç»“æŸ'} as HistoricalEvent
    ]],

    // 6æœˆ
    ['6-4', [
      { year: 1989, title: 'å…­å››äº‹ä»¶', description: 'å¤©å®‰é—¨å¹¿åœºå­¦ç”Ÿè¿åŠ¨é­åˆ°é•‡å‹'} as HistoricalEvent
    ]],
    ['6-5', [
      { year: 1967, title: 'å…­æ—¥æˆ˜äº‰', description: 'ä¸­ä¸œå…­æ—¥æˆ˜äº‰çˆ†å‘'} as HistoricalEvent
    ]],
    ['6-28', [
      { year: 1914, title: 'è¨æ‹‰çƒ­çªäº‹ä»¶', description: 'æ–è¿ªå—å¤§å…¬é‡åˆºï¼Œå¼•å‘ç¬¬ä¸€æ¬¡ä¸–ç•Œå¤§æˆ˜'} as HistoricalEvent,
      { year: 1969, title: 'çŸ³å¢™éªšä¹±', description: 'çŸ³å¢™éªšä¹±ï¼ŒLGBTQ+è¿åŠ¨çš„èµ·æº'} as HistoricalEvent
    ]],

    // 7æœˆ
    ['7-1', [
      { year: 1997, title: 'é¦™æ¸¯å›å½’', description: 'é¦™æ¸¯ä¸»æƒç§»äº¤ä¸­åäººæ°‘å…±å’Œå›½'} as HistoricalEvent,
      { year: 1921, title: 'ä¸­å…±æˆç«‹', description: 'ä¸­å›½å…±äº§å…šç¬¬ä¸€æ¬¡å…¨å›½ä»£è¡¨å¤§ä¼šå¬å¼€'} as HistoricalEvent
    ]],
    ['7-4', [
      { year: 1776, title: 'ç¾å›½ç‹¬ç«‹', description: 'ç¾å›½ç‹¬ç«‹å®£è¨€å‘è¡¨'} as HistoricalEvent
    ]],
    ['7-20', [
      { year: 1969, title: 'é˜¿æ³¢ç½—11å·', description: 'é˜¿å§†æ–¯ç‰¹æœ—å’Œå¥¥å°”å¾·æ—ç™»ä¸Šæœˆçƒ'} as HistoricalEvent,
      { year: 1976, title: 'æµ·ç›—1å·', description: 'æµ·ç›—1å·æ¢æµ‹å™¨ç™»é™†ç«æ˜Ÿ'} as HistoricalEvent
    ]],

    // 8æœˆ
    ['8-6', [
      { year: 1945, title: 'å¹¿å²›åŸå­å¼¹', description: 'ç¾å›½åœ¨å¹¿å²›æŠ•ä¸‹åŸå­å¼¹'} as HistoricalEvent,
      { year: 1991, title: 'ä¸‡ç»´ç½‘', description: 'è’‚å§†Â·ä¼¯çº³æ–¯-æå…¬å¼€ä¸‡ç»´ç½‘'} as HistoricalEvent
    ]],
    ['8-15', [
      { year: 1945, title: 'æ—¥æœ¬æŠ•é™', description: 'æ—¥æœ¬å®£å¸ƒæ— æ¡ä»¶æŠ•é™ï¼ŒäºŒæˆ˜ç»“æŸ'} as HistoricalEvent,
      { year: 1947, title: 'å°åº¦ç‹¬ç«‹', description: 'å°åº¦è„±ç¦»è‹±å›½ç‹¬ç«‹'} as HistoricalEvent
    ]],

    // 9æœˆ
    ['9-11', [
      { year: 2001, title: '911äº‹ä»¶', description: 'ææ€–åˆ†å­è¢­å‡»ä¸–è´¸ä¸­å¿ƒå’Œäº”è§’å¤§æ¥¼'} as HistoricalEvent
    ]],

    // 10æœˆ
    ['10-1', [
      { year: 1949, title: 'ä¸­åäººæ°‘å…±å’Œå›½æˆç«‹', description: 'æ¯›æ³½ä¸œåœ¨å¤©å®‰é—¨å®£å¸ƒä¸­åäººæ°‘å…±å’Œå›½æˆç«‹'} as HistoricalEvent
    ]],
    ['10-4', [
      { year: 1957, title: 'äººé€ å«æ˜Ÿ1å·', description: 'è‹è”å‘å°„ç¬¬ä¸€é¢—äººé€ å«æ˜Ÿ'} as HistoricalEvent,
      { year: 2004, title: 'å¤ªç©ºèˆ¹ä¸€å·', description: 'é¦–æ¬¡ç§äººè½½äººèˆªå¤©é£è¡Œ'} as HistoricalEvent
    ]],
    ['10-12', [
      { year: 1492, title: 'å“¥ä¼¦å¸ƒåˆ°è¾¾ç¾æ´²', description: 'å…‹é‡Œæ–¯æ‰˜å¼—Â·å“¥ä¼¦å¸ƒåˆ°è¾¾ç¾æ´²å¤§é™†'} as HistoricalEvent
    ]],

    // 11æœˆ
    ['11-9', [
      { year: 1989, title: 'æŸæ—å¢™å€’å¡Œ', description: 'æŸæ—å¢™å€’å¡Œï¼Œå†·æˆ˜è±¡å¾ç»“æŸ' } as HistoricalEvent
    ]],
    ['11-22', [
      { year: 1963, title: 'è‚¯å°¼è¿ªé‡åˆº', description: 'ç¾å›½æ€»ç»Ÿçº¦ç¿°Â·è‚¯å°¼è¿ªåœ¨è¾¾æ‹‰æ–¯é‡åˆº'} as HistoricalEvent,
      { year: 2005, title: 'Xbox 360', description: 'å¾®è½¯å‘å¸ƒXbox 360æ¸¸æˆæœº'} as HistoricalEvent
    ]],

    // 12æœˆ
    ['12-10', [
      { year: 1948, title: 'ä¸–ç•Œäººæƒå®£è¨€', description: 'è”åˆå›½é€šè¿‡ã€Šä¸–ç•Œäººæƒå®£è¨€ã€‹'} as HistoricalEvent
    ]],
    ['12-24', [
      { year: 1818, title: 'å¹³å®‰å¤œ', description: 'ã€Šå¹³å®‰å¤œã€‹åœ¨å¥¥åœ°åˆ©é¦–æ¬¡æ¼”å”±'} as HistoricalEvent,
      { year: 1968, title: 'é˜¿æ³¢ç½—8å·', description: 'é˜¿æ³¢ç½—8å·é¦–æ¬¡ç¯ç»•æœˆçƒé£è¡Œ'} as HistoricalEvent,
      { year: 2024, title: 'åœ£è¯å‰å¤œ', description: 'åœ£è¯èŠ‚å‰å¤•'} as HistoricalEvent
    ]],
    ['12-25', [
      { year: 1642, title: 'ç‰›é¡¿è¯ç”Ÿ', description: 'ç‰©ç†å­¦å®¶è‰¾è¨å…‹Â·ç‰›é¡¿å‡ºç”Ÿ'} as HistoricalEvent,
      { year: 1991, title: 'è‹è”è§£ä½“', description: 'è‹è”æ­£å¼è§£ä½“'} as HistoricalEvent
    ]],
    ['12-31', [
      { year: 1879, title: 'çˆ±è¿ªç”Ÿæ¼”ç¤ºç”µç¯', description: 'æ‰˜é©¬æ–¯Â·çˆ±è¿ªç”Ÿå…¬å¼€æ¼”ç¤ºç™½ç‚½ç¯æ³¡'} as HistoricalEvent
    ]],
  ]);

  static getEventsForDate(month: number, day: number): HistoricalEvent[] {
    const key = `${month}-${day}`;
    const result = HistoricalEventsData.events.get(key);
    return result !== undefined ? result : [];
  }

  static getTodayEvents(): HistoricalEvent[] {
    const today = new Date();
    return HistoricalEventsData.getEventsForDate(today.getMonth() + 1, today.getDate());
  }
}

@Entry
@Component
struct Index {
  @State currentDate: string = '';
  @State featuredEvent: HistoricalEvent | null = null;
  @State totalEventsCount: number = 0;

  aboutToAppear(): void {
    // log
    hilog.info(DOMAIN, 'testTag', '===== åº”ç”¨å¼€å§‹ =====');

    this.loadTodayEvent();

    hilog.info(DOMAIN, 'testTag', 'å½“å‰æ—¥æœŸ: %{public}s', this.currentDate);
    hilog.info(DOMAIN, 'testTag', 'äº‹ä»¶æ•°é‡: %{public}d', this.totalEventsCount);

    if (this.featuredEvent !== null) {
      hilog.info(DOMAIN, 'testTag', 'ç²¾é€‰äº‹ä»¶: %{public}s', this.featuredEvent.title);
    } else {
      hilog.info(DOMAIN, 'testTag', 'ä»Šå¤©æ²¡æœ‰äº‹ä»¶');
    }

    hilog.info(DOMAIN, 'testTag', '===== åŠ è½½å®Œæˆ =====');
  }

  loadTodayEvent(): void {
    const today = new Date();
    const options: Intl.DateTimeFormatOptions = {
      year: 'numeric',
      month: 'long',
      day: 'numeric',
      weekday: 'long'
    };

    this.currentDate = today.toLocaleDateString('zh-CN', options);
    const events = HistoricalEventsData.getTodayEvents();
    this.totalEventsCount = events.length;

    if (events.length > 0) {
      this.featuredEvent = events[0];
    } else {
      this.featuredEvent = null;
    }

    hilog.info(DOMAIN, 'testTag', 'åŠ è½½äº† %{public}d ä¸ªäº‹ä»¶', this.totalEventsCount);
  }

  goToDetailPage(): void {
    router.pushUrl({
      url: 'pages/HistoryDetail'
    }).catch((err: Error) => {
      hilog.error(DOMAIN, 'testTag', 'è·³è½¬å¤±è´¥: %{public}s', err.message);
    });
  }

  build() {
    Column() {
      // é¡¶éƒ¨æ ‡é¢˜
      Column() {
        Text('å†å²ä¸Šçš„ä»Šå¤©')
          .fontSize(32)
          .fontWeight(FontWeight.Bold)
          .fontColor('#FFFFFF')
          .margin({ bottom: 12 })

        Text(this.currentDate)
          .fontSize(16)
          .fontColor('#E0E0E0')
      }
      .width('100%')
      .padding(24)
      .backgroundColor('#1976D2')
      .alignItems(HorizontalAlign.Start)

      // ä¸»å†…å®¹
      if (this.featuredEvent !== null) {
        Column() {
          // ç²¾é€‰æ ‡ç­¾
          Text('ğŸ“Œ ä»Šæ—¥ç²¾é€‰')
            .fontSize(14)
            .fontColor('#1976D2')
            .fontWeight(FontWeight.Medium)
            .margin({ top: 32, bottom: 16 })

          // äº‹ä»¶å¡ç‰‡
          Column() {
            Text(this.featuredEvent.year.toString())
              .fontSize(72)
              .fontWeight(FontWeight.Bold)
              .fontColor('#1976D2')
              .margin({ bottom: 24 })

            Text(this.featuredEvent.title)
              .fontSize(28)
              .fontWeight(FontWeight.Bold)
              .fontColor('#212121')
              .textAlign(TextAlign.Center)
              .width('100%')
          }
          .width('85%')
          .padding(40)
          .backgroundColor('#FFFFFF')
          .borderRadius(20)
          .shadow({
            radius: 16,
            color: '#25000000',
            offsetX: 0,
            offsetY: 6
          })

          // æ›´å¤šæŒ‰é’®
          Button() {
            Row() {
              Text('æŸ¥çœ‹æ›´å¤š')
                .fontSize(16)
                .fontColor('#FFFFFF')
                .fontWeight(FontWeight.Medium)

              if (this.totalEventsCount > 1) {
                Text(` (è¿˜æœ‰${this.totalEventsCount - 1}ä¸ªäº‹ä»¶)`)
                  .fontSize(14)
                  .fontColor('#E0E0E0')
              }
            }
          }
          .width('85%')
          .height(56)
          .backgroundColor('#1976D2')
          .borderRadius(12)
          .margin({ top: 32 })
          .onClick(() => this.goToDetailPage())
        }
        .width('100%')
        .layoutWeight(1)
        .alignItems(HorizontalAlign.Center)
      } else {
        // æ²¡æœ‰äº‹ä»¶
        Column() {
          Text('ğŸ“…')
            .fontSize(80)
            .margin({ bottom: 24 })

          Text('ä»Šå¤©æ²¡æœ‰è®°å½•å†å²äº‹ä»¶')
            .fontSize(20)
            .fontColor('#757575')
        }
        .width('100%')
        .layoutWeight(1)
        .justifyContent(FlexAlign.Center)
      }
    }
    .width('100%')
    .height('100%')
    .backgroundColor('#F5F5F5')
  }
}
