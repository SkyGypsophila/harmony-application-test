import { hilog } from '@kit.PerformanceAnalysisKit';

const DOMAIN = 0x0000;

interface HistoricalEvent {
  year: number;
  title: string;
  description: string;
}

// data base
class HistoricalEventsData {
  private static events: Map<string, HistoricalEvent[]> = new Map<string, HistoricalEvent[]>([
    // 1
    ['1-1', [
      { year: 2002, title: 'Ê¨ßÂÖÉÊµÅÈÄö', description: 'Ê¨ßÂÖÉÂú®12‰∏™Ê¨ßÊ¥≤ÂõΩÂÆ∂ÂºÄÂßãÊµÅÈÄö'} as HistoricalEvent
    ]],
    ['1-15', [
      { year: 2001, title: 'Áª¥Âü∫ÁôæÁßë', description: 'Áª¥Âü∫ÁôæÁßëÊ≠£Âºè‰∏äÁ∫ø'} as HistoricalEvent
    ]],
    ['1-27', [
      { year: 2010, title: 'iPadÂèëÂ∏É', description: 'ËãπÊûúÂÖ¨Âè∏ÂèëÂ∏ÉÁ¨¨‰∏Ä‰ª£iPad'} as HistoricalEvent
    ]],

    // 2
    ['2-14', [
      { year: 1876, title: 'ÁîµËØùÂèëÊòé', description: '‰∫öÂéÜÂ±±Â§ß¬∑Ë¥ùÂ∞îËé∑ÂæóÁîµËØù‰∏ìÂà©'} as HistoricalEvent,
      { year: 1929, title: 'ÊÉÖ‰∫∫ËäÇÂ§ßÂ±†ÊùÄ', description: 'ËäùÂä†Âì•ÈªëÂ∏ÆÁÅ´Êãº‰∫ã‰ª∂'} as HistoricalEvent
    ]],
    ['2-24', [
      { year: 1955, title: '‰πîÂ∏ÉÊñØËØûÁîü', description: 'ËãπÊûúÂÖ¨Âè∏ËÅîÂêàÂàõÂßã‰∫∫Âè≤ËíÇÂ§´¬∑‰πîÂ∏ÉÊñØÂá∫Áîü'} as HistoricalEvent,
      { year: 2022, title: '‰øÑ‰πåÊàò‰∫â', description: '‰øÑÁΩóÊñØÂØπ‰πåÂÖãÂÖ∞ÂèëÂä®ÂÖ®Èù¢ÂÖ•‰æµ'} as HistoricalEvent
    ]],

    // 3
    ['3-8', [
      { year: 1911, title: 'ÂõΩÈôÖÂ¶áÂ•≥ËäÇ', description: 'È¶ñ‰∏™ÂõΩÈôÖÂä≥Âä®Â¶áÂ•≥ËäÇ'} as HistoricalEvent
    ]],
    ['3-14', [
      { year: 1879, title: 'Áà±Âõ†ÊñØÂù¶ËØûÁîü', description: 'Áâ©ÁêÜÂ≠¶ÂÆ∂ÈòøÂ∞î‰ºØÁâπ¬∑Áà±Âõ†ÊñØÂù¶Âá∫Áîü'} as HistoricalEvent,
      { year: 1995, title: 'IEÊµèËßàÂô®', description: 'ÂæÆËΩØÂèëÂ∏ÉInternet Explorer 1.0'} as HistoricalEvent
    ]],

    // 4
    ['4-12', [
      { year: 1961, title: 'Âä†Âä†ÊûóÂ§™Á©∫È£ûË°å', description: 'Â∞§Èáå¬∑Âä†Âä†ÊûóÊàê‰∏∫Á¨¨‰∏Ä‰∏™ËøõÂÖ•Â§™Á©∫ÁöÑ‰∫∫Á±ª'} as HistoricalEvent,
      { year: 1981, title: 'Âì•‰º¶ÊØî‰∫öÂè∑', description: 'Âì•‰º¶ÊØî‰∫öÂè∑Ëà™Â§©È£ûÊú∫È¶ñÊ¨°È£ûË°å'} as HistoricalEvent
    ]],

    // 5
    ['5-1', [
      { year: 1886, title: 'ÂõΩÈôÖÂä≥Âä®ËäÇ', description: 'ËäùÂä†Âì•Â∑•‰∫∫ÁΩ¢Â∑•ÔºåÂêéÊàê‰∏∫ÂõΩÈôÖÂä≥Âä®ËäÇËµ∑Ê∫ê'} as HistoricalEvent
    ]],
    ['5-8', [
      { year: 1945, title: 'Ê¨ßÊ¥≤ËÉúÂà©Êó•', description: '‰∫åÊàòÊ¨ßÊ¥≤ÊàòÂú∫ÁªìÊùü'} as HistoricalEvent
    ]],

    // 6
    ['6-4', [
      { year: 1989, title: 'ÂÖ≠Âõõ‰∫ã‰ª∂', description: 'Â§©ÂÆâÈó®ÂπøÂú∫Â≠¶ÁîüËøêÂä®ÈÅ≠Âà∞ÈïáÂéã'} as HistoricalEvent
    ]],
    ['6-5', [
      { year: 1967, title: 'ÂÖ≠Êó•Êàò‰∫â', description: '‰∏≠‰∏úÂÖ≠Êó•Êàò‰∫âÁàÜÂèë'} as HistoricalEvent
    ]],
    ['6-28', [
      { year: 1914, title: 'Ëê®ÊãâÁÉ≠Á™ù‰∫ã‰ª∂', description: 'ÊñêËø™ÂçóÂ§ßÂÖ¨ÈÅáÂà∫ÔºåÂºïÂèëÁ¨¨‰∏ÄÊ¨°‰∏ñÁïåÂ§ßÊàò'} as HistoricalEvent,
      { year: 1969, title: 'Áü≥Â¢ôÈ™ö‰π±', description: 'Áü≥Â¢ôÈ™ö‰π±ÔºåLGBTQ+ËøêÂä®ÁöÑËµ∑Ê∫ê'} as HistoricalEvent
    ]],

    // 7
    ['7-1', [
      { year: 1997, title: 'È¶ôÊ∏ØÂõûÂΩí', description: 'È¶ôÊ∏Ø‰∏ªÊùÉÁßª‰∫§‰∏≠Âçé‰∫∫Ê∞ëÂÖ±ÂíåÂõΩ'} as HistoricalEvent,
      { year: 1921, title: '‰∏≠ÂÖ±ÊàêÁ´ã', description: '‰∏≠ÂõΩÂÖ±‰∫ßÂÖöÁ¨¨‰∏ÄÊ¨°ÂÖ®ÂõΩ‰ª£Ë°®Â§ß‰ºöÂè¨ÂºÄ'} as HistoricalEvent
    ]],
    ['7-4', [
      { year: 1776, title: 'ÁæéÂõΩÁã¨Á´ã', description: 'ÁæéÂõΩÁã¨Á´ãÂÆ£Ë®ÄÂèëË°®'} as HistoricalEvent
    ]],
    ['7-20', [
      { year: 1969, title: 'ÈòøÊ≥¢ÁΩó11Âè∑', description: 'ÈòøÂßÜÊñØÁâπÊúóÂíåÂ••Â∞îÂæ∑ÊûóÁôª‰∏äÊúàÁêÉ'} as HistoricalEvent,
      { year: 1976, title: 'Êµ∑Áõó1Âè∑', description: 'Êµ∑Áõó1Âè∑Êé¢ÊµãÂô®ÁôªÈôÜÁÅ´Êòü'} as HistoricalEvent
    ]],

    // 8
    ['8-6', [
      { year: 1945, title: 'ÂπøÂ≤õÂéüÂ≠êÂºπ', description: 'ÁæéÂõΩÂú®ÂπøÂ≤õÊäï‰∏ãÂéüÂ≠êÂºπ'} as HistoricalEvent,
      { year: 1991, title: '‰∏áÁª¥ÁΩë', description: 'ËíÇÂßÜ¬∑‰ºØÁ∫≥ÊñØ-ÊùéÂÖ¨ÂºÄ‰∏áÁª¥ÁΩë'} as HistoricalEvent
    ]],
    ['8-15', [
      { year: 1945, title: 'Êó•Êú¨ÊäïÈôç', description: 'Êó•Êú¨ÂÆ£Â∏ÉÊó†Êù°‰ª∂ÊäïÈôçÔºå‰∫åÊàòÁªìÊùü'} as HistoricalEvent,
      { year: 1947, title: 'Âç∞Â∫¶Áã¨Á´ã', description: 'Âç∞Â∫¶ËÑ±Á¶ªËã±ÂõΩÁã¨Á´ã'} as HistoricalEvent
    ]],

    //9
    ['9-11', [
      { year: 2001, title: '911‰∫ã‰ª∂', description: 'ÊÅêÊÄñÂàÜÂ≠êË¢≠Âáª‰∏ñË¥∏‰∏≠ÂøÉÂíå‰∫îËßíÂ§ßÊ•º'} as HistoricalEvent
    ]],

    // 10
    ['10-1', [
      { year: 1949, title: '‰∏≠Âçé‰∫∫Ê∞ëÂÖ±ÂíåÂõΩÊàêÁ´ã', description: 'ÊØõÊ≥Ω‰∏úÂú®Â§©ÂÆâÈó®ÂÆ£Â∏É‰∏≠Âçé‰∫∫Ê∞ëÂÖ±ÂíåÂõΩÊàêÁ´ã'} as HistoricalEvent
    ]],
    ['10-4', [
      { year: 1957, title: '‰∫∫ÈÄ†Âç´Êòü1Âè∑', description: 'ËãèËÅîÂèëÂ∞ÑÁ¨¨‰∏ÄÈ¢ó‰∫∫ÈÄ†Âç´Êòü'} as HistoricalEvent,
      { year: 2004, title: 'Â§™Á©∫Ëàπ‰∏ÄÂè∑', description: 'È¶ñÊ¨°ÁßÅ‰∫∫ËΩΩ‰∫∫Ëà™Â§©È£ûË°å'} as HistoricalEvent
    ]],
    ['10-12', [
      { year: 1492, title: 'Âì•‰º¶Â∏ÉÂà∞ËææÁæéÊ¥≤', description: 'ÂÖãÈáåÊñØÊâòÂºó¬∑Âì•‰º¶Â∏ÉÂà∞ËææÁæéÊ¥≤Â§ßÈôÜ'} as HistoricalEvent
    ]],

    // 11
    ['11-9', [
      { year: 1989, title: 'ÊüèÊûóÂ¢ôÂÄíÂ°å', description: 'ÊüèÊûóÂ¢ôÂÄíÂ°åÔºåÂÜ∑ÊàòË±°ÂæÅÁªìÊùü' } as HistoricalEvent,
    ]],
    ['11-22', [
      { year: 1963, title: 'ËÇØÂ∞ºËø™ÈÅáÂà∫', description: 'ÁæéÂõΩÊÄªÁªüÁ∫¶Áø∞¬∑ËÇØÂ∞ºËø™Âú®ËææÊãâÊñØÈÅáÂà∫'} as HistoricalEvent,
      { year: 2005, title: 'Xbox 360', description: 'ÂæÆËΩØÂèëÂ∏ÉXbox 360Ê∏∏ÊàèÊú∫'} as HistoricalEvent
    ]],

    // 12
    ['12-10', [
      { year: 1948, title: '‰∏ñÁïå‰∫∫ÊùÉÂÆ£Ë®Ä', description: 'ËÅîÂêàÂõΩÈÄöËøá„Ää‰∏ñÁïå‰∫∫ÊùÉÂÆ£Ë®Ä„Äã'} as HistoricalEvent
    ]],

    ['12-24', [
      { year: 1818, title: 'Âπ≥ÂÆâÂ§ú', description: '„ÄäÂπ≥ÂÆâÂ§ú„ÄãÂú®Â••Âú∞Âà©È¶ñÊ¨°ÊºîÂî±'} as HistoricalEvent,
      { year: 1968, title: 'ÈòøÊ≥¢ÁΩó8Âè∑', description: 'ÈòøÊ≥¢ÁΩó8Âè∑È¶ñÊ¨°ÁéØÁªïÊúàÁêÉÈ£ûË°å'} as HistoricalEvent,
      { year: 2025, title: 'Â§úËØóÊÅã', description: 'Â§úËØóÊÅãFelistaÂΩìÂâçÁöÑÊó∂Èó¥ÊÆµ'} as HistoricalEvent
    ]],
    ['12-25', [
      { year: 1642, title: 'ÁâõÈ°øËØûÁîü', description: 'Áâ©ÁêÜÂ≠¶ÂÆ∂ËâæËê®ÂÖã¬∑ÁâõÈ°øÂá∫Áîü'} as HistoricalEvent,
      { year: 1991, title: 'ËãèËÅîËß£‰Ωì', description: 'ËãèËÅîÊ≠£ÂºèËß£‰Ωì'} as HistoricalEvent,
      { year: 2025, title: 'Â§úËØóÊÅã', description: 'Â§úËØóÊÅãFelistaÂΩìÂâçÁöÑÊó∂Èó¥ÊÆµ'} as HistoricalEvent
    ]],
    ['12-31', [
      { year: 1879, title: 'Áà±Ëø™ÁîüÊºîÁ§∫ÁîµÁÅØ', description: 'ÊâòÈ©¨ÊñØ¬∑Áà±Ëø™ÁîüÂÖ¨ÂºÄÊºîÁ§∫ÁôΩÁÇΩÁÅØÊ≥°'} as HistoricalEvent
    ]],
  ]);

  static getEventsForDate(month: number, day: number): HistoricalEvent[] {
    const key = `${month}-${day}`;
    const result = HistoricalEventsData.events.get(key);
    if (result !== undefined) {
      return result;
    } else {
      return [];
    }
  }

  static getTodayEvents(): HistoricalEvent[] {
    const today = new Date();
    return HistoricalEventsData.getEventsForDate(today.getMonth() + 1, today.getDate());
  }
}

@Entry
@Component
struct Index {
  @State currentDate: string = '';
  @State events: HistoricalEvent[] = [];

  aboutToAppear(): void {
    this.loadTodayEvents();
  }

  loadTodayEvents(): void {
    const today = new Date();
    const options: Intl.DateTimeFormatOptions = {
      year: 'numeric',
      month: 'long',
      day: 'numeric',
      weekday: 'long'
    };
    this.currentDate = today.toLocaleDateString('zh-CN', options);
    this.events = HistoricalEventsData.getTodayEvents();

    hilog.info(DOMAIN, 'testTag', 'Â∑≤Âä†ËΩΩ %{public}d ‰∏™ÂéÜÂè≤‰∫ã‰ª∂', this.events.length);
  }


  build() {
    Column() {
      // È°∂ÈÉ®ÂØºËà™Ê†è
      Row() {
        // ËøîÂõûÊåâÈíÆ
        Row() {
          Text('‚Üê ')
            .fontSize(20)
            .fontColor('#FFFFFF')
          Text('ËøîÂõû')
            .fontSize(16)
            .fontColor('#FFFFFF')
        }
        .padding(8)
        Blank()

        // Ê†áÈ¢ò
        Text('ÂÖ®ÈÉ®‰∫ã‰ª∂')
          .fontSize(18)
          .fontWeight(FontWeight.Medium)
          .fontColor('#FFFFFF')

        Blank()

        // Âç†‰ΩçÔºà‰øùÊåÅÊ†áÈ¢òÂ±Ö‰∏≠Ôºâ
        Row()
          .width(60)
      }
      .width('100%')
      .height(56)
      .padding({ left: 16, right: 16 })
      .backgroundColor('#1976D2')

      // Êó•ÊúüÊòæÁ§∫
      Column() {
        Text(this.currentDate)
          .fontSize(16)
          .fontColor('#757575')
          .margin({ top: 16, bottom: 8 })

        Text(`ÂÖ± ${this.events.length} ‰∏™ÂéÜÂè≤‰∫ã‰ª∂`)
          .fontSize(14)
          .fontColor('#9E9E9E')
      }
      .width('100%')
      .padding({ left: 16, right: 16 })
      .backgroundColor('#FFFFFF')

      // ‰∫ã‰ª∂ÂàóË°®
      if (this.events.length > 0) {
        this.EventsList()
      } else {
        this.NoEventsSection()
      }
    }
    .width('100%')
    .height('100%')
    .backgroundColor('#F5F5F5')
  }

  @Builder
  EventsList() {
    List({ space: 12 }) {
      ForEach(this.events, (event: HistoricalEvent, index: number) => {
        ListItem() {
          this.EventCard(event, index)
        }
      }, (event: HistoricalEvent, index: number) => `${index}-${event.year}-${event.title}`)
    }
    .width('100%')
    .layoutWeight(1)
    .padding({ left: 16, right: 16, top: 16, bottom: 16 })
  }

  @Builder
  EventCard(event: HistoricalEvent, index: number) {
    Column() {
      Row() {
        // Âπ¥‰ªΩ
        Column() {
          Text(event.year.toString())
            .fontSize(24)
            .fontWeight(FontWeight.Bold)
            .fontColor('#1976D2')
        }
        .width(80)
        .justifyContent(FlexAlign.Center)

        // ÂÜÖÂÆπ
        Column() {
          Text(event.title)
            .fontSize(18)
            .fontWeight(FontWeight.Medium)
            .fontColor('#212121')
            .maxLines(2)
            .textOverflow({ overflow: TextOverflow.Ellipsis })

          Text(event.description)
            .fontSize(14)
            .fontColor('#757575')
            .margin({ top: 6 })
            .maxLines(3)
            .textOverflow({ overflow: TextOverflow.Ellipsis })
        }
        .layoutWeight(1)
        .alignItems(HorizontalAlign.Start)
        .margin({ left: 16 })
      }
      .width('100%')
      .alignItems(VerticalAlign.Top)
    }
    .width('100%')
    .padding(16)
    .backgroundColor('#FFFFFF')
    .borderRadius(12)
    .shadow({
      radius: 8,
      color: '#15000000',
      offsetX: 0,
      offsetY: 2
    })
  }

  @Builder
  NoEventsSection() {
    Column() {
      Text('üìÖ')
        .fontSize(64)
        .margin({ bottom: 16 })

      Text('Ëøô‰∏ÄÂ§©Ê≤°ÊúâËÆ∞ÂΩï')
        .fontSize(18)
        .fontColor('#757575')
        .margin({ bottom: 8 })

      Text('ÂéÜÂè≤‰∫ã‰ª∂')
        .fontSize(14)
        .fontColor('#9E9E9E')
    }
    .width('100%')
    .layoutWeight(1)
    .justifyContent(FlexAlign.Center)
  }
}